<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>Tapestry Segmentation Analyzer - ArcGIS Maps SDK for JavaScript</title>
    
    <!-- The esriConfig variable must be defined before adding the other esri libraries -->
    <script>
      var esriConfig = {
        apiKey: "AAPTxy8BH1VEsoebNVZXo8HurHudtAypLm328sIJojSUcoWK4iawKp87GbOMcJ3USNJwbndtRPTvMP12Xu8gplWdFxyarXcZvh-Wi0yEb2PjnVog6aVtAPW_PJVrt1yU5FoDf4nM4Fa8hNK9FKRtBWb5h6L-KsYUy-_YYZiNWkKSEGwec1YXJfisQ7ES5SI1DIUWDQw_fbU5d7Dr2xKCHOrwBZAOpNZOF4Cyh06brHeismavZ0bmp3qv2hHvt-ShN2FnAT1_VQn5OsAR",
      };
    </script>
    
    <!-- Load Calcite components from CDN -->
    <script type="module" src="https://js.arcgis.com/calcite-components/3.2.1/calcite.esm.js"></script>
    <!-- Load the ArcGIS Maps SDK for JavaScript from CDN -->
    <link rel="stylesheet" href="https://js.arcgis.com/4.33/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/4.33/"></script>
    <!-- Load Map components from CDN-->
    <script type="module" src="https://js.arcgis.com/4.33/map-components/"></script>
    
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }
      
      .app-container {
        display: flex;
        flex-direction: column;
        height: 100vh;
      }
      
      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1rem;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      
      .header h1 {
        margin: 0;
        font-size: 1.8rem;
        font-weight: 700;
      }
      
      .header p {
        margin: 0.5rem 0 0 0;
        font-size: 0.9rem;
        opacity: 0.9;
      }
      
      .main-content {
        display: flex;
        flex: 1;
        overflow: hidden;
      }
      
      .sidebar {
        width: 350px;
        background: white;
        border-right: 1px solid #e1e5e9;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      
      .sidebar-content {
        padding: 1rem;
        overflow-y: auto;
        flex: 1;
      }
      
      .panel-section {
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #f0f0f0;
      }
      
      .panel-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
      }
      
      .panel-section h2 {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
        color: #333;
      }
      
      .input-group {
        margin-bottom: 1rem;
      }
      
      .input-group calcite-input {
        margin-bottom: 0.5rem;
      }
      
      .map-container {
        flex: 1;
        position: relative;
      }
      
      .results-panel {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: white;
        border-top: 1px solid #e1e5e9;
        max-height: 300px;
        overflow: hidden;
        display: none;
        box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
      }
      
      .results-panel.active {
        display: flex;
        flex-direction: column;
      }
      
      .results-header {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 0.75rem 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      
      .results-header h3 {
        margin: 0;
        font-size: 1rem;
      }
      
      .results-content {
        flex: 1;
        overflow-y: auto;
        padding: 1rem;
      }
      
      .tapestry-result {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
        border-left: 4px solid #667eea;
      }
      
      .segment-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 0.75rem;
        margin: 1rem 0;
      }
      
      .segment-item {
        background: white;
        padding: 0.75rem;
        border-radius: 6px;
        border: 1px solid #e1e5e9;
      }
      
      .demographics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 0.75rem;
        margin-top: 1rem;
      }
      
      .demographic-item {
        background: white;
        padding: 0.75rem;
        border-radius: 6px;
        text-align: center;
        border: 1px solid #e1e5e9;
      }
      
      .demographic-item h4 {
        color: #667eea;
        margin: 0 0 0.5rem 0;
        font-size: 0.8rem;
        text-transform: uppercase;
      }
      
      .demographic-item .value {
        font-size: 1.1rem;
        font-weight: bold;
        color: #333;
      }
      
      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }
      
      .loading-overlay.active {
        display: flex;
      }
      
      .loading-content {
        background: white;
        padding: 2rem;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      }
      
      .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        color: white;
        font-weight: 600;
        z-index: 1001;
        animation: slideIn 0.3s ease;
        max-width: 300px;
      }
      
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
      
      .csv-info {
        background: #f8f9fa;
        padding: 0.75rem;
        border-radius: 6px;
        border-left: 3px solid #667eea;
        margin-top: 0.75rem;
        font-size: 0.85rem;
        color: #666;
      }
      
      .recent-searches {
        max-height: 150px;
        overflow-y: auto;
      }
      
      .recent-search-item {
        background: #f8f9fa;
        padding: 0.5rem;
        border-radius: 6px;
        margin-bottom: 0.5rem;
        cursor: pointer;
        transition: all 0.3s ease;
        border-left: 3px solid #667eea;
        font-size: 0.85rem;
      }
      
      .recent-search-item:hover {
        background: #e9ecef;
        transform: translateX(5px);
      }
      
      .empty-state {
        text-align: center;
        color: #999;
        font-style: italic;
        padding: 1rem 0;
        font-size: 0.85rem;
      }
      
      @media (max-width: 768px) {
        .main-content {
          flex-direction: column;
        }
        
        .sidebar {
          width: 100%;
          height: auto;
          max-height: 300px;
        }
        
        .map-container {
          height: 400px;
        }
      }
    </style>
  </head>
  
  <body>
    <div class="app-container">
      <!-- Header -->
      <div class="header">
        <h1>üéØ Tapestry Segmentation Analyzer</h1>
        <p>Discover demographic insights using Esri's GeoEnrichment service and Tapestry Segmentation</p>
        <p style="font-size: 0.8rem; margin-top: 0.5rem; opacity: 0.8;">‚úÖ Using real ArcGIS GeoEnrichment API data</p>
      </div>
      
      <!-- Main Content -->
      <div class="main-content">
        <!-- Sidebar -->
        <div class="sidebar">
          <div class="sidebar-content">
            <!-- Address Lookup -->
            <div class="panel-section">
              <h2>üìç Address Lookup</h2>
              <div class="input-group">
                <calcite-input 
                  id="addressInput" 
                  placeholder="Enter an address (e.g., 123 Main St, New York, NY)"
                  scale="m"
                  clearable>
                </calcite-input>
                <calcite-button 
                  id="searchAddressBtn" 
                  appearance="solid" 
                  color="blue" 
                  scale="m" 
                  width="full">
                  Search
                </calcite-button>
              </div>
            </div>
            
            <!-- CSV Upload -->
            <div class="panel-section">
              <h2>üìä CSV Upload</h2>
              <div class="input-group">
                <calcite-input 
                  id="csvFileInput" 
                  type="file" 
                  accept=".csv"
                  scale="m">
                </calcite-input>
                <calcite-button 
                  id="processCsvBtn" 
                  appearance="outline" 
                  color="blue" 
                  scale="m" 
                  width="full">
                  Process CSV
                </calcite-button>
              </div>
              <div class="csv-info">
                <p><strong>CSV Format:</strong> latitude,longitude,description (optional)</p>
                <p><strong>Example:</strong> 40.7128,-74.0060,New York City</p>
              </div>
            </div>
            
            <!-- Recent Searches -->
            <div class="panel-section">
              <h2>üìã Recent Searches</h2>
              <div id="recentSearches" class="recent-searches">
                <p class="empty-state">No recent searches</p>
              </div>
            </div>
            
            <!-- Map Controls -->
            <div class="panel-section">
              <h2>üó∫Ô∏è Map Controls</h2>
              <div class="input-group">
                <calcite-button 
                  id="clearMapBtn" 
                  appearance="outline" 
                  color="neutral" 
                  scale="m" 
                  width="full">
                  Clear Map
                </calcite-button>
                <calcite-button 
                  id="exportResultsBtn" 
                  appearance="outline" 
                  color="neutral" 
                  scale="m" 
                  width="full">
                  Export Results
                </calcite-button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Map Container -->
        <div class="map-container">
          <arcgis-map 
            id="mapView"
            basemap="arcgis/streets-vector" 
            center="-98.5795, 39.8283" 
            zoom="4"
            style="width: 100%; height: 100%;">
            <arcgis-zoom position="top-left"></arcgis-zoom>
            <arcgis-search position="top-right"></arcgis-search>
            <arcgis-home position="top-left"></arcgis-home>
          </arcgis-map>
          
          <!-- Debug info -->
          <div id="mapDebug" style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 5px; font-size: 12px; border-radius: 4px; display: none;">
            Map Status: <span id="mapStatus">Loading...</span>
          </div>
        </div>
          
          <!-- Results Panel -->
          <div class="results-panel" id="resultsPanel">
            <div class="results-header">
              <h3>üìà Tapestry Results</h3>
              <calcite-button 
                id="closeResultsBtn" 
                appearance="transparent" 
                color="inverse" 
                scale="s"
                icon="x">
              </calcite-button>
            </div>
            <div id="resultsContent" class="results-content">
              <div class="loading-state">
                <div class="spinner"></div>
                <p>Analyzing location...</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
      <div class="loading-content">
        <div class="spinner"></div>
        <p id="loadingMessage">Processing...</p>
      </div>
    </div>
    
    <script src="app.js"></script>
  </body>
</html>
